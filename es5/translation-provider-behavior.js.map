{"version":3,"sources":["translation-provider-behavior.js"],"names":[],"mappings":"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","file":"translation-provider-behavior.js","sourcesContent":["(function(){\r\n    'use strict';\r\n\r\n    window.JS = window.JS || {};\r\n\r\n    var langRegExp = /^([A-Za-z]*)-[A-Za-z]*$/gi, //regular expression for navigator language descriptors\r\n        i18n = {}; //cache for fetched translations\r\n\r\n\r\n    /**\r\n     * `JS.TranslationProviderBehavior` allows to use `$t` property as binding provider for translation fetched from json files in i18n directory.\r\n     * It also provides possibility to synchronise translation with children extending `JS.TranslationReceiverBehavior`.\r\n     * If provider is a child of another provider it will treat its translation as a prototype for own translation.\r\n     * Provider synchronises language with `$c.lang` context property therefore it also extends `JS.ContextReceiverBehavior`.\r\n     *\r\n     * Translation files should be named {element.is}\\_{ln}-{LN}.json or {element.is}\\_{ln}.json.\r\n     * @polymerBehavior JS.TranslationProviderBehavior\r\n     */\r\n    JS.TranslationProviderBehaviorImpl = {\r\n        properties: {\r\n            /**\r\n             * Directory from which the translations will be fetched. If element is extending `JS.Settings{Provider|Receiver}Behavior` it will default to `$s.i18n`.\r\n             * @default 'i18n/'\r\n             */\r\n            $tUrl: {\r\n                type: String\r\n            },\r\n            /**\r\n             * Default language for translation. If element is extending `JS.Settings{Provider|Receiver}Behavior` it will default to `$s.defaultLang`.\r\n             * @default 'en'\r\n             */\r\n            $tDefaultLang: {\r\n                type: String\r\n            },\r\n            _$tBaseListeners: {\r\n                type: Array,\r\n                value(){ return []; }\r\n            },\r\n            _$tListeners: {\r\n                type: Array,\r\n                value(){ return []; }\r\n            },\r\n            _$tRequest: {\r\n                type: Object,\r\n                computed: '_$tGetTranslation($c.lang)'\r\n            },\r\n            _$tBase: {\r\n                type: Object,\r\n                value(){ return {}; }\r\n            },\r\n            _$t: {\r\n                type: Object,\r\n                value(){ return {}; }\r\n            },\r\n            /**\r\n             * Object containing fetched translation.\r\n             */\r\n            $t: {\r\n                type: Object,\r\n                value(){ return {}; }\r\n            }\r\n        },\r\n        observers: [\r\n            '_$tTranslate(_$tBase, _$t)'\r\n        ],\r\n        listeners: {\r\n            'translation-required': '_$tRegisterElement',\r\n            'translation-released': '_$tUnregisterElement'\r\n        },\r\n        ready(){\r\n            //set initial values\r\n            this.$tDefaultLang = this.$tDefaultLang || this._$tGetDefaultLang();\r\n            this.$tUrl = this.$tUrl || this._$tGetUrl();\r\n        },\r\n        attached(){\r\n            /**\r\n             * Fired when element is attached. Subscribes base translation to parent provider if exists\r\n             * @event translation-required\r\n             */\r\n            this.fire('translation-required', { base: this });\r\n        },\r\n        detached(){\r\n            /**\r\n             * Fired when element is detached. Unsubscribes from parent translation provider\r\n             * @event translation-released\r\n             */\r\n            this.fire('translation-released', { base: this });\r\n        },\r\n        //Method computing locales url\r\n        _$tGetUrl: function getUrl(){\r\n            return this.$s && this.$s.i18n || 'i18n/';\r\n        },\r\n        //Method computing default language\r\n        _$tGetDefaultLang: function getDefaultLang() {\r\n            return this.$s && this.$s.defaultLang || 'en';\r\n        },\r\n        //Method registering elements that require translation\r\n        _$tRegisterElement: function registerElement(e){\r\n            var detail = e.detail,\r\n                element = detail.target || detail.base,\r\n                array = detail.target ? this._$tListeners : this._$tBaseListeners;\r\n            if(element !== this){\r\n                e.stopPropagation();\r\n                array.push(element);\r\n            }\r\n        },\r\n        //Method unregistering elements that no longer require translation\r\n        _$tUnregisterElement: function unregisterElement(e){\r\n            var detail = e.detail,\r\n                element = detail.target || detail.base,\r\n                array = detail.target ? this._$tListeners : this._$tBaseListeners,\r\n                index = array.indexOf(element);\r\n            array.splice(index, 1);\r\n        },\r\n        //Method acquiring translation\r\n        _$tGetTranslation: function getTranslation(lang, handleOnFail){\r\n            var descriptor = [this.is, '_', lang].join('');\r\n            if(i18n[descriptor]){\r\n                return new Promise((resolve) => {\r\n                    this.set('_$t', i18n[descriptor]);\r\n                    this.async(() => resolve(i18n[descriptor]));\r\n                });\r\n            }else{\r\n                return new Promise((resolve, reject) => {\r\n                    this.async(() => {\r\n                        this.$http.get([this.$tUrl, descriptor, '.json'].join('')).then((res) => {\r\n                            this.set('_$t', res);\r\n                            i18n[[this.is, '_', this.$c.lang].join('')] = res;\r\n                            resolve(res);\r\n                        }, () => {\r\n                            var match = langRegExp.exec(lang);\r\n                            if(match){\r\n                                getTranslation.call(this, match[1]).then(resolve, reject);\r\n                            }else if(!handleOnFail){\r\n                                getTranslation.call(this, this.$tDefaultLang, true).then(resolve, reject);\r\n                            }else{\r\n                                reject(new Error('Failed to load translation file for ' + this.is));\r\n                            }\r\n                        });\r\n                    });\r\n                });\r\n            }\r\n        },\r\n        //Method performing translation\r\n        _$tTranslate: function translate(_$tBase, _$t){\r\n            return new Promise((resolve) => {\r\n                //constructor for translation object\r\n                function Translation(json){\r\n                    for(var key in json){\r\n                        this[key] = json[key];\r\n                    }\r\n                }\r\n                //prototype assignment\r\n                Translation.prototype = _$tBase;\r\n                var translation = new Translation(_$t);\r\n                this._$tBaseListeners.forEach((val) => {\r\n                    val.set('_$tBase', translation);\r\n                });\r\n                this._$tListeners.forEach((val) => {\r\n                    val.set('$t', translation);\r\n                });\r\n                //bind translation\r\n                this.set('$t', translation);\r\n                resolve(translation);\r\n            });\r\n        }\r\n    };\r\n    JS.TranslationProviderBehavior = [JS.AjaxBehavior, JS.ContextReceiverBehavior, JS.TranslationProviderBehaviorImpl];\r\n\r\n})();\r\n"],"sourceRoot":"/source/"}