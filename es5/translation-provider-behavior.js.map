{"version":3,"sources":["translation-provider-behavior.js"],"names":[],"mappings":"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","file":"translation-provider-behavior.js","sourcesContent":["(function(){\n    'use strict';\n\n    window.JS = window.JS || {};\n\n    var langRegExp = /^([A-Za-z]*)-[A-Za-z]*$/gi, //regular expression for navigator language descriptors\n        i18n = {}; //cache for fetched translations\n\n\n    /**\n     * `JS.TranslationProviderBehavior` allows to use `$t` property as binding provider for translation fetched from json files in i18n directory.\n     * It also provides possibility to synchronise translation with children extending `JS.TranslationReceiverBehavior`.\n     * If provider is a child of another provider it will treat its translation as a prototype for own translation.\n     * Provider synchronises language with `$c.lang` context property therefore it also extends `JS.ContextReceiverBehavior`.\n     *\n     * Translation files should be named {element.is}_ln-LN.json or {element.is}_ln.json.\n     * @polymerBehavior JS.TranslationProviderBehavior\n     */\n    JS.TranslationProviderBehaviorImpl = {\n        properties: {\n            /**\n             * Directory from which the translations will be fetched. If element is extending `JS.Settings{Provider|Receiver}Behavior` it will default to `$s.i18n`.\n             * @default 'i18n/'\n             */\n            $tUrl: {\n                type: String,\n                value(){ return this.$s && this.$s.i18n || 'i18n/'; }\n            },\n            /**\n             * Default language for translation. If element is extending `JS.Settings{Provider|Receiver}Behavior` it will default to `$s.defaultLang`.\n             * @default 'en'\n             */\n            $tDefaultLang: {\n                type: String,\n                value(){ return this.$s && this.$s.defaultLang || 'en'; }\n            },\n            _$tBaseListeners: {\n                type: Array,\n                value(){ return []; }\n            },\n            _$tListeners: {\n                type: Array,\n                value(){ return []; }\n            },\n            _$tRequest: {\n                type: Object,\n                computed: '_$tGetTranslation($c.lang)'\n            },\n            _$tBase: {\n                type: Object,\n                value(){ return {}; }\n            },\n            _$t: {\n                type: Object,\n                value(){ return {}; }\n            },\n            /**\n             * Object containing fetched translation.\n             */\n            $t: {\n                type: Object,\n                value(){ return {}; }\n            }\n        },\n        observers: [\n            '_$tTranslate(_$tBase, _$t)'\n        ],\n        listeners: {\n            'translation-required': '_$tRegisterElement',\n            'translation-released': '_$tUnregisterElement'\n        },\n        attached(){\n            /**\n             * Fired when element is attached. Lets element check if there is some more base translation to set as a prototype.\n             * @event translation-required\n             */\n            this.fire('translation-required', { base: this });\n        },\n        detached(){\n            /**\n             * Fired when element is detached. Unsubscribes parent translation provider.\n             * @event translation-released\n             */\n            this.fire('translation-released', { base: this });\n        },\n\n        //Method registering elements that require translation\n        _$tRegisterElement: function registerElement(e){\n            var detail = e.detail,\n                element = detail.target || detail.base,\n                array = detail.target ? this._$tListeners : this._$tBaseListeners;\n            if(element !== this){\n                e.stopPropagation();\n                array.push(element);\n            }\n        },\n\n        //Method unregistering elements that no longer require translation\n        _$tUnregisterElement: function unregisterElement(e){\n            var detail = e.detail,\n                element = detail.target || detail.base,\n                array = detail.target ? this._$tListeners : this._$tBaseListeners,\n                index = array.indexOf(element);\n            array.splice(index, 1);\n        },\n\n        //Method acquiring translation\n        _$tGetTranslation: function getTranslation(lang, handleOnFail){\n            var descriptor = [this.is, '_', lang].join('');\n            if(i18n[descriptor]){\n                return new Promise((resolve) => {\n                    this.set('_$t', i18n[descriptor]);\n                    this.async(() => resolve(i18n[descriptor]));\n                });\n            }else{\n                return new Promise((resolve, reject) => {\n                    this.async(() => {\n                        this.$http.get([this.$tUrl, descriptor, '.json'].join('')).then((res) => {\n                            this.set('_$t', res);\n                            i18n[[this.is, '_', this.$c.lang].join('')] = res;\n                            resolve(res);\n                        }, () => {\n                            var match = langRegExp.exec(lang);\n                            if(match){\n                                getTranslation.call(this, match[1]).then(resolve, reject);\n                            }else if(!handleOnFail){\n                                getTranslation.call(this, this.$tDefaultLang, true).then(resolve, reject);\n                            }else{\n                                reject(new Error('Failed to load translation file for ' + this.is));\n                            }\n                        });\n                    });\n                });\n            }\n        },\n\n        //Method performing translation\n        _$tTranslate: function translate(_$tBase, _$t){\n            return new Promise((resolve) => {\n                //constructor for translation object\n                function Translation(json){\n                    for(var key in json){\n                        this[key] = json[key];\n                    }\n                }\n                //prototype assignment\n                Translation.prototype = _$tBase;\n                var translation = new Translation(_$t);\n                this._$tBaseListeners.forEach((val) => {\n                    val.set('_$tBase', translation);\n                });\n                this._$tListeners.forEach((val) => {\n                    val.set('$t', translation);\n                });\n                //bind translation\n                this.set('$t', translation);\n                resolve(translation);\n            });\n        }\n    };\n    JS.TranslationProviderBehavior = [JS.AjaxBehavior, JS.ContextReceiverBehavior, JS.TranslationProviderBehaviorImpl];\n\n})();\n"],"sourceRoot":"/source/"}